<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Calculadora de Costos Arbitrales</title>

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600&family=Poppins:wght@300;400;500&display=swap" rel="stylesheet">

<style>
  :root{
    --vino:#68092b;
    --vino-oscuro:#42041a;
    --dorado:#d2ae6d;
    --dorado-oscuro:#b8955a;
    --gris:#e7e7e7;
    --texto:#2d2d2d;
  }

  *{ box-sizing:border-box; }

  body{
    font-family:'Poppins', sans-serif;
    background:#f8f3ed;
    margin:0;
    padding:20px;
    color:var(--texto);
  }

  .calc-container{
    max-width:960px;
    margin:0 auto;
    background:white;
    border-radius:14px;
    border:2px solid var(--vino);
    padding:35px 40px;
    box-shadow:0 18px 35px rgba(66,4,26,0.12);
  }

  h1{
    font-family:"Montserrat", sans-serif;
    font-size:30px;
    font-weight:700;
    color:var(--vino);
    text-align:center;
    margin:0 0 6px;
  }

  .sub{
    text-align:center;
    margin-bottom:24px;
    color:#5c5c5c;
    font-size:15px;
  }

  .top-links{
    display:flex;
    gap:12px;
    justify-content:center;
    flex-wrap:wrap;
    margin-bottom:22px;
  }

  .top-link{
    padding:10px 18px;
    border:2px solid var(--vino);
    color:var(--vino);
    border-radius:10px;
    font-weight:600;
    text-decoration:none;
    font-size:14px;
    transition:all .2s ease;
    background:#fff;
  }

  .top-link:hover{
    background:var(--vino);
    color:white;
  }

  .choice-row{
    display:flex;
    gap:12px;
    margin-bottom:24px;
    flex-wrap:wrap;
    justify-content:center;
  }

  .choice{
    position:relative;
    display:flex;
    align-items:center;
    gap:8px;
    padding:12px 18px;
    border-radius:12px;
    border:2px solid var(--vino);
    color:var(--vino);
    font-weight:700;
    cursor:pointer;
    transition:all .2s ease;
    background:#fff;
  }

  .choice input{ display:none; }

  .choice.active{
    background:var(--vino);
    color:white;
    box-shadow:0 10px 20px rgba(104,9,43,0.2);
  }

  .section-card{
    border:1px solid #ebebeb;
    background:#fcf9f5;
    border-radius:12px;
    padding:18px 20px 14px;
    margin-bottom:18px;
  }

  .section-header{
    display:flex;
    align-items:center;
    gap:10px;
    margin-bottom:12px;
  }

  .section-title{
    font-size:18px;
    font-family:Montserrat, sans-serif;
    font-weight:700;
    color:var(--vino);
    margin:0;
  }

  .field-grid{
    display:grid;
    grid-template-columns:1fr auto;
    gap:12px;
    align-items:end;
  }

  .form-group{ margin-bottom:12px; }

  .form-group label{
    display:block;
    font-weight:600;
    font-size:14px;
    margin-bottom:6px;
    color:#4a4a4a;
  }

  .input-wrap{
    display:flex;
    align-items:center;
    background:white;
    border:1px solid #dcdcdc;
    border-radius:10px;
    padding:0 12px;
    box-shadow:inset 0 1px 2px rgba(0,0,0,0.04);
  }

  .input-wrap .prefix{
    font-weight:700;
    color:var(--vino);
    margin-right:10px;
  }

  .input-wrap input,
  .form-group select{
    width:100%;
    padding:12px 10px;
    border:none;
    font-size:15px;
    font-family:'Poppins', sans-serif;
    background:transparent;
    outline:none;
  }

  .form-group select{
    border:1px solid #dcdcdc;
    border-radius:10px;
    background:white;
    padding:12px;
  }

  .currency-toggle{
    display:inline-flex;
    background:#f1e7da;
    border-radius:30px;
    padding:4px;
    border:1px solid var(--dorado-oscuro);
    gap:6px;
  }

  .currency-btn{
    border:none;
    background:transparent;
    padding:8px 14px;
    border-radius:20px;
    font-weight:700;
    color:var(--vino);
    cursor:pointer;
    transition:all .2s ease;
  }

  .currency-btn.active{
    background:var(--dorado);
    color:var(--vino-oscuro);
  }

  .currency-btn:disabled{
    cursor:not-allowed;
    opacity:0.7;
  }

  .pretension-box{
    background:white;
    border:1px solid #e3e0dc;
    padding:16px 16px 8px;
    border-radius:12px;
    margin-bottom:12px;
    position:relative;
    box-shadow:0 6px 12px rgba(0,0,0,0.04);
  }

  .pretension-title{
    font-size:16px;
    font-family:Montserrat, sans-serif;
    font-weight:700;
    color:var(--vino);
    margin:0 0 10px;
  }

  .delete-btn{
    position:absolute;
    top:10px;
    right:10px;
    background:none;
    border:none;
    font-size:16px;
    color:var(--vino);
    font-weight:700;
    cursor:pointer;
    transition:0.2s;
  }

  .delete-btn:hover{ color:var(--vino-oscuro); }

  .add-btn{
    width:100%;
    background:var(--dorado);
    color:var(--vino-oscuro);
    border:none;
    padding:14px;
    border-radius:30px;
    font-weight:700;
    letter-spacing:0.3px;
    cursor:pointer;
    box-shadow:0 8px 15px rgba(0,0,0,0.08);
    transition:all .2s ease;
  }

  .add-btn:hover{ background:var(--dorado-oscuro); }

  .cta{
    width:100%;
    background:var(--vino);
    color:white;
    border:none;
    padding:15px;
    border-radius:14px;
    font-weight:800;
    font-size:16px;
    cursor:pointer;
    box-shadow:0 14px 25px rgba(66,4,26,0.25);
    transition:all .2s ease;
    margin-top:10px;
  }

  .cta:hover{ background:var(--vino-oscuro); }

  .result{
    margin-top:24px;
    padding:22px;
    border-radius:14px;
    background:#fefbf6;
    border:2px solid var(--dorado);
    box-shadow:0 10px 18px rgba(0,0,0,0.08);
  }

  .result h2{
    font-size:20px;
    font-family:Montserrat, sans-serif;
    font-weight:700;
    color:var(--vino);
    margin:0 0 12px;
  }

  .result p{
    font-size:15px;
    margin:6px 0;
    color:#4a4a4a;
  }

  .result span{
    font-weight:700;
    color:var(--vino);
  }

  @media(max-width:700px){
    body{ padding:12px; }
    .calc-container{ padding:24px; }
    .field-grid{ grid-template-columns:1fr; }
    .choice-row{ flex-direction:column; }
  }

</style>
</head>
<body>

<div class="calc-container">
  <h1>Calculadora de Costos</h1>
  <div class="sub">Calcule los costos arbitrales según las pretensiones determinadas o indeterminadas.</div>

  <div class="top-links">
    <a class="top-link" href="#">TABLA DE COSTOS ARBITRALES</a>
    <a class="top-link" href="#">REGLAMENTO DE COSTOS ARBITRALES</a>
  </div>

  <div class="choice-row">
    <label class="choice active" for="arbitroUnico">
      <input type="radio" id="arbitroUnico" name="tipoArbitro" value="unico" checked>
      Calcular con Árbitro Único
    </label>
    <label class="choice" for="tribunalArbitral">
      <input type="radio" id="tribunalArbitral" name="tipoArbitro" value="tribunal">
      Calcular con Tribunal Arbitral
    </label>
  </div>

  <div class="section-card">
    <div class="section-header">
      <h3 class="section-title">Monto Contractual</h3>
      <div class="currency-toggle">
        <button class="currency-btn active" type="button">S/</button>
        <button class="currency-btn" type="button" disabled>USD</button>
      </div>
    </div>
    <div class="form-group">
      <label>Monto contractual (S/):</label>
      <div class="input-wrap">
        <span class="prefix">S/</span>
        <input type="number" id="montoContractual" placeholder="Ingrese el monto contractual">
      </div>
    </div>
  </div>

  <div class="section-card">
    <div class="section-header">
      <h3 class="section-title">Pretensiones</h3>
      <div class="currency-toggle">
        <button class="currency-btn active" type="button">S/</button>
        <button class="currency-btn" type="button" disabled>USD</button>
      </div>
    </div>
    <div id="pretensiones-container"></div>
    <button class="add-btn" onclick="agregarPretension()">+ AGREGAR PRETENSIÓN</button>
  </div>

  <button class="cta" onclick="calcular()">CALCULAR</button>

  <div id="resultado" class="result" style="display:none;">
    <h2>Resumen de costos</h2>
    <p><strong>Cuantía Total:</strong> <span id="cuantiaTotal"></span></p>
    <p><strong>Gastos Administrativos:</strong> <span id="gastosAdmin"></span></p>
    <p><strong>Honorarios Arbitrales:</strong> <span id="honorariosArbitrales"></span></p>
    <p><strong>Total sin IGV:</strong> <span id="totalPagarSinIGV"></span></p>
    <p><strong>Total con IGV (18%):</strong> <span id="totalPagarConIGV"></span></p>
  </div>

</div>


<!-- =====================
     LÓGICA JS COMPLETA
===================== -->

<script>
/* TABLAS - ANEXO N°2 */
const gastosAdminBrackets = [
  { minQ: 20001, maxQ: 60000, baseExcess: 15000, rate: 0.06, minAmt:1200, maxAmt:3900 },
  { minQ: 60001, maxQ:150000, baseExcess:60000, rate:0.04, minAmt:3900, maxAmt:7500 },
  { minQ:150001, maxQ:300000, baseExcess:150000, rate:0.02, minAmt:7500, maxAmt:10500 },
  { minQ:300001, maxQ:500000, baseExcess:300000, rate:0.015,minAmt:10500,maxAmt:13500 },
  { minQ:500001, maxQ:1000000, baseExcess:500000, rate:0.01,minAmt:13500,maxAmt:18500 },
  { minQ:1000001,maxQ:5000000, baseExcess:1000000, rate:0.005,minAmt:18500,maxAmt:38500 },
  { minQ:5000001,maxQ:50000000,baseExcess:5000000, rate:0.002,minAmt:38500,maxAmt:128500 },
  { minQ:50000000.01,maxQ:Infinity,baseExcess:50000000,rate:0.003,minAmt:128500,maxAmt:null }
];

const arbitroUnicoBrackets = [
  { minQ:20001,maxQ:60000, baseExcess:15000, rate:0.065,minAmt:1300,maxAmt:4225 },
  { minQ:60001,maxQ:150000,baseExcess:60000,rate:0.07,minAmt:4225,maxAmt:10525 },
  { minQ:150001,maxQ:300000,baseExcess:150000,rate:0.02,minAmt:10525,maxAmt:13525 },
  { minQ:300001,maxQ:500000,baseExcess:300000,rate:0.006,minAmt:13525,maxAmt:14725 },
  { minQ:500001,maxQ:1000000,baseExcess:500000,rate:0.008,minAmt:14725,maxAmt:18725 },
  { minQ:1000001,maxQ:5000000,baseExcess:1000000,rate:0.005,minAmt:18725,maxAmt:38725 },
  { minQ:5000001,maxQ:50000000,baseExcess:5000000,rate:0.003,minAmt:38725,maxAmt:173725 },
  { minQ:50000000.01,maxQ:Infinity,baseExcess:50000000,rate:0.003,minAmt:173725,maxAmt:null }
];

const tribunalBrackets = [
  { minQ:20001,maxQ:60000,baseExcess:15000,rate:0.30,minAmt:4500,maxAmt:18000 },
  { minQ:60001,maxQ:150000,baseExcess:60000,rate:0.12,minAmt:18000,maxAmt:28800 },
  { minQ:150001,maxQ:300000,baseExcess:150000,rate:0.05,minAmt:28800,maxAmt:36300 },
  { minQ:300001,maxQ:500000,baseExcess:300000,rate:0.035,minAmt:36300,maxAmt:43300 },
  { minQ:500001,maxQ:1000000,baseExcess:500000,rate:0.026,minAmt:43300,maxAmt:56300 },
  { minQ:1000001,maxQ:5000000,baseExcess:1000000,rate:0.015,minAmt:56300,maxAmt:116300 },
  { minQ:5000001,maxQ:50000000,baseExcess:5000000,rate:0.008,minAmt:116300,maxAmt:476300 },
  { minQ:50000000.01,maxQ:Infinity,baseExcess:50000000,rate:0.008,minAmt:476300,maxAmt:null }
];

/* SISTEMA DE PRETENSIONES */
let pretensionCount = 0;
agregarPretension();

document.querySelectorAll('.choice input').forEach(radio => {
  radio.addEventListener('change', actualizarEleccion);
});

actualizarEleccion();

function actualizarEleccion(){
  document.querySelectorAll('.choice').forEach(choice => {
    const input = choice.querySelector('input');
    choice.classList.toggle('active', input.checked);
  });
}

function agregarPretension(){
  pretensionCount++;

  const id = pretensionCount;
  const container = document.getElementById("pretensiones-container");

  const div = document.createElement("div");
  div.className="pretension-box";
  div.id=`pret-${id}`;

  div.innerHTML=`
    <button class="delete-btn" onclick="eliminarPret(${id})">✖</button>
    <h4 class="pretension-title">Pretensión ${id}</h4>

    <div class="form-group">
      <label>Tipo de pretensión:</label>
      <select id="tipo${id}" onchange="toggleInd(${id})">
        <option value="determinada">Determinada</option>
        <option value="indeterminada">Indeterminada</option>
      </select>
    </div>

    <div class="form-group" id="montoDiv${id}">
      <label>Monto de la pretensión (S/):</label>
      <div class="input-wrap">
        <span class="prefix">S/</span>
        <input type="number" id="monto${id}" placeholder="Solo si es determinada">
      </div>
    </div>

    <div class="form-group" id="motivoDiv${id}" style="display:none;">
      <label>Motivo:</label>
      <select id="motivo${id}">
        <option value="penalidad">Penalidad (10%)</option>
        <option value="nulidad">Nulidad o resolución (100%)</option>
        <option value="indet">Indeterminada (5%)</option>
      </select>
    </div>
  `;

  container.appendChild(div);

  renumerarPretensiones();
}

function eliminarPret(id){
    document.getElementById(`pret-${id}`).remove();
    renumerarPretensiones();
}

function toggleInd(i){
  const tipo = document.getElementById(`tipo${i}`).value;
  document.getElementById(`montoDiv${i}`).style.display = tipo==="determinada" ? "block" : "none";
  document.getElementById(`motivoDiv${i}`).style.display = tipo==="indeterminada" ? "block" : "none";
}

function renumerarPretensiones() {
  const pretensiones = document.querySelectorAll('.pretension-box');

  let num = 1;
  pretensiones.forEach(box => {
    // actualizar título
    const title = box.querySelector('.pretension-title');
    title.textContent = `Pretensión ${num}`;

    // actualizar IDs internos para no romper lógica
    box.id = `pret-${num}`;

    // actualizar select e inputs internos
    box.querySelectorAll('[id]').forEach(el => {
      const base = el.id.replace(/[0-9]/g, ''); // quita números
      el.id = base + num;
    });

    num++;
  });

  pretensionCount = pretensiones.length;
}

/* CÁLCULO POR TABLA */
function calcularPorTabla(cuantia, tabla){
  for(const b of tabla){
    if(cuantia >= b.minQ && cuantia <= b.maxQ){
      let calc = b.rate * (cuantia - b.baseExcess);
      if(calc < b.minAmt) calc = b.minAmt;
      if(b.maxAmt !== null && calc > b.maxAmt) calc = b.maxAmt;
      return calc;
    }
  }
  return 0;
}

/* CÁLCULO FINAL */
function calcular(){
  const mc = parseFloat(document.getElementById("montoContractual").value);
  if(isNaN(mc) || mc<=0){ alert("Ingrese un monto contractual válido."); return; }

  let cuantia = 0;

  for(let i=1;i<=pretensionCount;i++){
    const box = document.getElementById(`pret-${i}`);
    if(!box) continue;

    const tipo = document.getElementById(`tipo${i}`).value;

    if(tipo==="determinada"){
      const m = parseFloat(document.getElementById(`monto${i}`).value);
      if(m>0) cuantia += m;
    } else {
      const motivo = document.getElementById(`motivo${i}`).value;
      if(motivo==="penalidad") cuantia += mc*0.10;
      else if(motivo==="nulidad") cuantia += mc;
      else cuantia += mc*0.05;
    }
  }

  if(cuantia < 20001){
    alert("La cuantía total está por debajo de S/ 20,001 (primer rango oficial).");
    return;
  }

  const usarUnico = document.getElementById("arbitroUnico").checked;

  const gastos = calcularPorTabla(cuantia, gastosAdminBrackets);
  const honorarios = calcularPorTabla(cuantia, usarUnico ? arbitroUnicoBrackets : tribunalBrackets);

  const totalSin = gastos + honorarios;
  const totalCon = totalSin * 1.18;

  document.getElementById("cuantiaTotal").textContent = cuantia.toFixed(2);
  document.getElementById("gastosAdmin").textContent = gastos.toFixed(2);
  document.getElementById("honorariosArbitrales").textContent = honorarios.toFixed(2);
  document.getElementById("totalPagarSinIGV").textContent = totalSin.toFixed(2);
  document.getElementById("totalPagarConIGV").textContent = totalCon.toFixed(2);

  document.getElementById("resultado").style.display="block";
}

</script>

</body>
</html>
